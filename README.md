# Tree Crown Instance Segmentation
blurb

## Framework Structure
* `config/` - definition of config files, which defines architecture, pretrained model to load, hyperparameters...
* `datasets/`
* `lib/` - libraries and dependencies
* `deepent/` - our library
    * `data` - module for data preprocessing and processing for training and evaluation
    * `modelling` - model architectures
    * `tools` - additional tools for visualization...
* `output/` - files generated by framework such as models, logs, summaries, checkpoints ...
* `notebooks/` - documentation logbooks
* `docs/` - model zoo descrioptions
* `setup` - setup script
* `train` - train script for Leonhard
* `train_net.py` - trianing procedure

## Environments

### Leonhard

Ensure you are connected to the ETH network.
```
ssh [your_ETH_alias]@login.leonhard.ethz.ch
```
Remember to load modules:
```
module load gcc/6.3.0 python_gpu/3.7.4
```
### AWS

Remember to load the pytorch build:
```
source activate pytorch_p36
```

### Setup

1. Clone repo:
```
cd ~
git clone https://github.com/roeetal/drone-tree-id.git
```
2. run setup script (for leonhard modify pip install to take `--user` argument):
```
cd ~/drone-tree-id
chmod +x setup
./setup
```

## Benchmarking
To benchmark training or evalutation sessions:

## Training

To train the model, run the training script with appropriate flags:
* `--config-file`: the config file to load
* `OUTPUT_DIR`: the output path directory
For example:
```
python train_net.py --config-file configs/deepent_rcnn_R_101_FPN.yaml OUTPUT_DIR /path/to/output/dir
```

### Leonhard

You can run a batch training by compiling and executing the `train` script

## Evaluation

To evaluation the model, run the training script with appropriate flags:
* `--config-file`: the config file to load
* `MODEL.WEIGHTS`: the weight file to load
For example:
```
python train_net.py --config-file /home/ubuntu/drone-tree-id/configs/deepent_rcnn_R_50_FPN.yaml --eval-only MODEL.WEIGHTS /home/ubuntu/drone-tree-id/output/model_0034999.pth
```

## Visualization

To create a 6x2 sample visualization of model inference, run the following with the appropriate arguments:
* `--config-file`: the config file to load
* `--model`: the weight file to load`
* `--dataset`: name of the dataset
* `--threshold`: confidence threshold
* `--samples`: number of sample visualizations to produce
* `--output`: path to store visualizations
```
python vis.py --threshold 0.5 --config-file configs/deepent_rcnn_R_50_FPN.yaml --model output/model_0034999.pth --samples 1 --dataset CPT2a-n_test --output output/vis/
```
